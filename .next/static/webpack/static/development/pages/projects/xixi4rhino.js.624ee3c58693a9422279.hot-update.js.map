{"version":3,"file":"static/webpack/static/development/pages/projects/xixi4rhino.js.624ee3c58693a9422279.hot-update.js","sources":["webpack:///./components/Projects/ProjectDetail/index.tsx","webpack:///./pages/projects/xixi4rhino.tsx"],"sourcesContent":["import React, { FC, useEffect } from 'react';\nimport styles from './index.module.less';\nimport LazyLoadImg, { LazyLoadImgProps } from '../../common/LazyLoadImg';\nimport { useResizeCallback } from '../../../utils/hooks/useResizeCallback';\nimport { useForceUpdate } from '../../../utils/hooks/useForceUpdate';\nimport throttle from 'lodash/throttle';\nexport interface ProjectDetailInfoProps {\n  images: LazyLoadImgProps[];\n  title: string;\n  desc: string[];\n  tags: string[];\n  details: string;\n  mainColor: string;\n  detail_images_meta: {\n    dir: string;\n    num: number;\n  };\n  links?: {\n    src: string\n    className: string,\n    desc: string\n  }[]\n  video?: [\n    {\n      src: string;\n    }\n  ];\n  affix_image_meta?: {\n    dir: string;\n    num: number;\n  };\n}\n\ntype IProps = ProjectDetailInfoProps;\n\nexport const ProjectDetailItem: FC<IProps> = (props: IProps) => {\n  const {\n    images,\n    title,\n    desc,\n    links,\n    tags,\n    details,\n    mainColor,\n    detail_images_meta,\n    video,\n    affix_image_meta\n  } = props;\n  const videoRef = React.useRef<any>({\n    duration: 0,\n    currentTime: 0,\n    fake: true\n  });\n  const [played, setPlayed] = React.useState<boolean | undefined>(undefined);\n  const [visible, setVisible] = React.useState<boolean>(false);\n  const { forceUpdate } = useForceUpdate();\n  const [progress, setProgress] = React.useState<number>(0);\n  useEffect(() => {\n    if (!videoRef.current.fake && document) {\n      document.onscroll = () => {\n        if (videoRef.current!.getBoundingClientRect().top < 700) {\n          if (played === undefined) {\n            videoRef.current.play();\n            setPlayed(true);\n          }\n        } else if (videoRef.current!.getBoundingClientRect().bottom < 150) {\n          videoRef.current.pause();\n          setPlayed(false);\n        }\n      };\n    }\n  }, [videoRef.current, document, played]);\n  const { addMustExecuteCallback } = useResizeCallback();\n  addMustExecuteCallback(() => {\n    forceUpdate();\n  });\n  useEffect(() => {\n    const handleTimeUpdate = throttle(() => {\n      setProgress(\n        (videoRef.current.currentTime / videoRef.current.duration) * 100\n      );\n    }, 500);\n    if (!videoRef.current.fake) {\n      videoRef.current.addEventListener('timeupdate', handleTimeUpdate);\n    }\n  }, [videoRef.current, setProgress]);\n\n  return (\n    <div\n      className={styles['project-detail-item']}\n      style={{\n        color: mainColor\n      }}\n    >\n      <div className={styles['project-detail-images']}>\n        {images.map(image => (\n          <LazyLoadImg {...image} className={styles['project-detail-image']} />\n        ))}\n      </div>\n      <div>\n        <div className={styles['project-detail-title']}>{title}</div>\n        <div className={styles['project-detail-subtitle']}>\n          {desc.map(d => (\n            <span>{d}</span>\n          ))}\n        </div>\n      </div>\n      <div\n        className={styles['project-detail-details']}\n        style={{\n          backgroundColor: mainColor\n        }}\n      >\n        <div className={styles['project-detail-tags']}>\n          {tags.map(t => (\n            <span>{t}</span>\n          ))}\n        </div>\n        {details.length > 0 && (\n          <span className={styles['project-detail-details-desc']}>\n            {details}\n          </span>\n        )}\n      </div>\n      <div\n        style={{\n          fontSize: 0\n        }}\n      >\n        {Array.from({ length: detail_images_meta.num }).map((_, i) => {\n          if (i === 0) {\n            return;\n          }\n          const common_file = detail_images_meta.dir + '/' + (i + 1).toString();\n          return (\n            <LazyLoadImg\n              src={common_file + '.jpg'}\n              sources={[\n                {\n                  type: 'image/webp',\n                  src: common_file + '.webp'\n                }\n              ]}\n              preview_src={common_file + '-preview.jpg'}\n              preview_sources={[\n                { type: 'image/webp', src: common_file + '-preview.webp' }\n              ]}\n              className={styles['project-detail-details-images']}\n            />\n          );\n        })}\n        {\n          links.map(link => <a className={link.className} href={link.src} target={'blank'}>{desc}</a>)\n        }\n        {video\n          ? video.map(v => {\n              return (\n                <div\n                  style={{\n                    width: '1600rem',\n                    position: 'relative',\n                    height: '900rem',\n                    transition: '0.3s ease-in-out',\n                    filter: played == true ? 'none' : 'opacity(0.9)'\n                  }}\n                  onMouseEnter={() => {\n                    setVisible(true);\n                  }}\n                  onMouseLeave={() => {\n                    setVisible(false);\n                  }}\n                  onClick={() => {\n                    if (played) {\n                      videoRef.current.pause();\n                      setPlayed(false);\n                    } else {\n                      videoRef.current.play();\n                      setPlayed(true);\n                    }\n                  }}\n                >\n                  <div\n                    className={styles['project-detail-stop-icon']}\n                    style={{\n                      display: played == true ? 'none' : 'block'\n                    }}\n                  >\n                    PAUSE\n                  </div>\n                  <div\n                    style={{\n                      transition: '.4s ease',\n                      opacity: visible ? 1 : 0\n                    }}\n                    className={styles['project-detail-video-control-bar']}\n                  >\n                    <div className={styles['bar']}>\n                      <div\n                        className={styles['progress']}\n                        style={{\n                          width: progress + '%'\n                        }}\n                      />\n                    </div>\n                  </div>\n                  <video\n                    src={v.src}\n                    ref={videoRef}\n                    autoPlay={false}\n                    style={{\n                      width: '1600rem',\n                      float: 'left'\n                    }}\n                  />\n                </div>\n              );\n            })\n          : null}\n        {affix_image_meta\n          ? Array.from({ length: affix_image_meta.num }).map((_, i) => {\n              if (i === 0) {\n                return;\n              }\n              const common_file =\n                affix_image_meta.dir +\n                '/' +\n                (detail_images_meta.num + i + 1).toString();\n              return (\n                <LazyLoadImg\n                  src={common_file + '.jpg'}\n                  sources={[\n                    {\n                      type: 'image/webp',\n                      src: common_file + '.webp'\n                    }\n                  ]}\n                  preview_src={common_file + '-preview.jpg'}\n                  preview_sources={[\n                    { type: 'image/webp', src: common_file + '-preview.webp' }\n                  ]}\n                  className={styles['project-detail-details-images']}\n                />\n              );\n            })\n          : null}\n      </div>\n    </div>\n  );\n};\n\nexport default ProjectDetailItem;\n","import * as React from 'react';\nimport { useEffect, useState } from 'react';\nimport styles from '../index.less';\nimport LayoutHeader from '../../components/LayoutHeader';\nimport {\n  CurrentTabProvider,\n  useCurrentTab\n} from '../../utils/hooks/useCurrentTab';\nimport { ContentSwitcher } from '../../components/ContentSwitcher';\nimport { useComponentDidMount } from '../../utils/hooks/useComponentDidMount';\nimport { useResizeCallback } from '../../utils/hooks/useResizeCallback';\nimport ProjectDetailItem, {\n  ProjectDetailInfoProps\n} from '../../components/Projects/ProjectDetail';\nimport Profile from '../../components/Profile';\nimport Projects from '../../components/Projects';\nimport RhinoStyles from './xixi4rhino.less';\n\nconst DESIGN_WIDTH = 1920;\nconst COMMON_STATIC_PATH = '/static/images/projectDetails/img';\nconst Info: ProjectDetailInfoProps = {\n  title: 'xixi4rhino',\n  mainColor: '#9E0601',\n  desc: [\n    'a website for rhino protection',\n    'by impacting potential consumers directly'\n  ],\n  details: `‘xixi4rhino’ is a website for Rhino Protection, aiming to change Chinese potential consumers’ rhino horns purchase intention and create better Internet information environment about rhino horns. It’s critical to directly impact the consumption intention of Chinese potential consumers and make them abandon the purchase when rhinos are poached for rhino horns. In the Chinese market, as the Internet plays an import role on consumption decision, we created the website with an entrapping name “Rhino Horn Purchase Guide” to induce people to click and browse it. The glitch art video at the beginning contains bloody scene and dialogue box interaction to make potential consumers shocked powerfully. After that, the webpage informs people about the correct knowledge of the rhino horns and encourage them to forward or donate, so that the website could be more widely spread.`,\n  tags: ['Society Innovation | Web UI and UX Design | Team Work in 5 weeks | Mar 2018 '],\n  images: [\n    {\n      src: COMMON_STATIC_PATH + '7.jpg',\n      sources: [\n        {\n          src: COMMON_STATIC_PATH + '7.webp',\n          type: 'image/webp'\n        }\n      ],\n      preview_src: COMMON_STATIC_PATH + '7-preview.jpg',\n      preview_sources: [\n        {\n          src: COMMON_STATIC_PATH + '7-preview.webp',\n          type: 'image/webp'\n        }\n      ],\n      alt: 'rhino'\n    }\n  ],\n  detail_images_meta: {\n    dir: '/static/images/projectDetails/xixi4rhino',\n    num: 1\n  },\n  links: [{\n    src: 'http://144.34.173.162/foreign-projects/project-rhino',\n    desc: 'Click Here To Enter',\n    className: styles\n  }],\n  affix_image_meta: {\n    dir: '/static/images/projectDetails/xixi4rhino',\n    num: 6\n  }\n};\nconst menuItems = [\n  {\n    key: 'xixi4rhino',\n    label: 'xixi4rhino'\n  }\n];\nconst InnerLayout: React.FC<{}> = () => {\n  const {\n    state: {\n      scale: { scale }\n    },\n    actions: { setScale, setCurrentTab }\n  } = useCurrentTab();\n  const [isLoading, setIsLoading] = useState(true);\n  const fallBackReactive = () => {\n    setScale(1);\n    const scale = Math.min(document.body.clientWidth / 1920, 1);\n    let metaEl = document.querySelector('meta[name=\"viewport\"]');\n    if (!metaEl) {\n      metaEl = document.createElement('meta');\n      metaEl.setAttribute('name', 'viewport');\n      metaEl.setAttribute(\n        'content',\n        'width=device-width, initial-scale=' +\n          scale +\n          ', maximum-scale=' +\n          scale +\n          ', minimum-scale=' +\n          scale +\n          ', user-scalable=no'\n      );\n      document.documentElement.firstElementChild.appendChild(metaEl);\n    } else {\n      metaEl.setAttribute(\n        'content',\n        'width=device-width, initial-scale=' +\n          scale +\n          ', maximum-scale=' +\n          scale +\n          ', minimum-scale=' +\n          scale +\n          ', user-scalable=no'\n      );\n    }\n\n    window.scrollTo({\n      top: 0\n    });\n  };\n  // innerWidth 比 body.offsetWidth 稳定\n  const { IsDone } = useComponentDidMount(() => {\n    setCurrentTab(1);\n    if (window.innerWidth >= 700) {\n      const scale = Math.max(\n        Math.min(window.innerWidth / DESIGN_WIDTH, 1),\n        0.2\n      );\n      setScale(scale);\n    } else {\n      fallBackReactive();\n    }\n    addCallback(() => {\n      const scale = Math.max(\n        Math.min(window.innerWidth / DESIGN_WIDTH, 1),\n        0.2\n      );\n      document.getElementsByTagName('html')[0].style.fontSize = `${scale}px`;\n      window.scrollTo({\n        top: 0\n      });\n      setScale(scale);\n    });\n  });\n  useEffect(() => {\n    setIsLoading(true);\n    document.getElementsByTagName('html')[0].style.fontSize = `${scale}px`;\n    window.scrollTo({\n      top: 0\n    });\n    // 强行将这次setState推迟到下次处理\n    setTimeout(() => {\n      setIsLoading(false);\n    }, 0);\n  }, [scale]);\n  const { addCallback } = useResizeCallback(fallBackReactive);\n  return IsDone && !isLoading ? (\n    <div className={styles.layout}>\n      <LayoutHeader menuItems={menuItems} />\n      <ContentSwitcher>\n        <Profile />\n        <ProjectDetailItem {...Info} />\n        <Projects />\n      </ContentSwitcher>\n      <LayoutHeader\n        menuItems={menuItems}\n        bodyStyle={{\n          marginTop: '138rem'\n        }}\n      />\n    </div>\n  ) : null;\n};\n\nconst Layout: React.FC<{}> = () => {\n  return (\n    <CurrentTabProvider>\n      <InnerLayout />\n    </CurrentTabProvider>\n  );\n};\n\nexport default Layout;\n"],"mappings":"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","sourceRoot":""}