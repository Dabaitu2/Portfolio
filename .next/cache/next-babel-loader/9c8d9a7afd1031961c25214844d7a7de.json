{"ast":null,"code":"import _Array$from from \"@babel/runtime-corejs2/core-js/array/from\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar __jsx = React.createElement;\nimport React, { useEffect } from 'react';\nimport styles from './index.module.less';\nimport LazyLoadImg from '../../common/LazyLoadImg';\nimport { useResizeCallback } from '../../../utils/hooks/useResizeCallback';\nimport { useForceUpdate } from '../../../utils/hooks/useForceUpdate';\nimport throttle from 'lodash/throttle';\nexport var ProjectDetailItem = function ProjectDetailItem(props) {\n  var images = props.images,\n      title = props.title,\n      desc = props.desc,\n      links = props.links,\n      tags = props.tags,\n      details = props.details,\n      mainColor = props.mainColor,\n      detail_images_meta = props.detail_images_meta,\n      video = props.video,\n      affix_image_meta = props.affix_image_meta;\n  var videoRef = React.useRef({\n    duration: 0,\n    currentTime: 0,\n    fake: true\n  });\n\n  var _React$useState = React.useState(undefined),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      played = _React$useState2[0],\n      setPlayed = _React$useState2[1];\n\n  var _React$useState3 = React.useState(false),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      visible = _React$useState4[0],\n      setVisible = _React$useState4[1];\n\n  var _useForceUpdate = useForceUpdate(),\n      forceUpdate = _useForceUpdate.forceUpdate;\n\n  var _React$useState5 = React.useState(0),\n      _React$useState6 = _slicedToArray(_React$useState5, 2),\n      progress = _React$useState6[0],\n      setProgress = _React$useState6[1];\n\n  useEffect(function () {\n    if (!videoRef.current.fake && document) {\n      document.onscroll = function () {\n        if (videoRef.current.getBoundingClientRect().top < 700) {\n          if (played === undefined) {\n            videoRef.current.play();\n            setPlayed(true);\n          }\n        } else if (videoRef.current.getBoundingClientRect().bottom < 150) {\n          videoRef.current.pause();\n          setPlayed(false);\n        }\n      };\n    }\n  }, [videoRef.current, document, played]);\n\n  var _useResizeCallback = useResizeCallback(),\n      addMustExecuteCallback = _useResizeCallback.addMustExecuteCallback;\n\n  addMustExecuteCallback(function () {\n    forceUpdate();\n  });\n  useEffect(function () {\n    var handleTimeUpdate = throttle(function () {\n      setProgress(videoRef.current.currentTime / videoRef.current.duration * 100);\n    }, 500);\n\n    if (!videoRef.current.fake) {\n      videoRef.current.addEventListener('timeupdate', handleTimeUpdate);\n    }\n  }, [videoRef.current, setProgress]);\n  return __jsx(\"div\", {\n    className: styles['project-detail-item'],\n    style: {\n      color: mainColor\n    }\n  }, __jsx(\"div\", {\n    className: styles['project-detail-images']\n  }, images.map(function (image) {\n    return __jsx(LazyLoadImg, _extends({}, image, {\n      className: styles['project-detail-image']\n    }));\n  })), __jsx(\"div\", null, __jsx(\"div\", {\n    className: styles['project-detail-title']\n  }, title), __jsx(\"div\", {\n    className: styles['project-detail-subtitle']\n  }, desc.map(function (d) {\n    return __jsx(\"span\", null, d);\n  }))), __jsx(\"div\", {\n    className: styles['project-detail-details'],\n    style: {\n      backgroundColor: mainColor\n    }\n  }, __jsx(\"div\", {\n    className: styles['project-detail-tags']\n  }, tags.map(function (t) {\n    return __jsx(\"span\", null, t);\n  })), details.length > 0 && __jsx(\"span\", {\n    className: styles['project-detail-details-desc']\n  }, details)), __jsx(\"div\", {\n    style: {\n      fontSize: 0\n    }\n  }, _Array$from({\n    length: detail_images_meta.num\n  }).map(function (_, i) {\n    if (i === 0) {\n      return;\n    }\n\n    var common_file = detail_images_meta.dir + '/' + (i + 1).toString();\n    return __jsx(LazyLoadImg, {\n      src: common_file + '.jpg',\n      sources: [{\n        type: 'image/webp',\n        src: common_file + '.webp'\n      }],\n      preview_src: common_file + '-preview.jpg',\n      preview_sources: [{\n        type: 'image/webp',\n        src: common_file + '-preview.webp'\n      }],\n      className: styles['project-detail-details-images']\n    });\n  }), links && links.map(function (link) {\n    return __jsx(\"a\", {\n      className: link.className,\n      href: link.src,\n      target: 'blank'\n    }, link.desc);\n  }), video ? video.map(function (v) {\n    return __jsx(\"div\", {\n      style: {\n        width: '1600rem',\n        position: 'relative',\n        height: '900rem',\n        transition: '0.3s ease-in-out',\n        filter: played == true ? 'none' : 'opacity(0.9)'\n      },\n      onMouseEnter: function onMouseEnter() {\n        setVisible(true);\n      },\n      onMouseLeave: function onMouseLeave() {\n        setVisible(false);\n      },\n      onClick: function onClick() {\n        if (played) {\n          videoRef.current.pause();\n          setPlayed(false);\n        } else {\n          videoRef.current.play();\n          setPlayed(true);\n        }\n      }\n    }, __jsx(\"div\", {\n      className: styles['project-detail-stop-icon'],\n      style: {\n        display: played == true ? 'none' : 'block'\n      }\n    }, \"PAUSE\"), __jsx(\"div\", {\n      style: {\n        transition: '.4s ease',\n        opacity: visible ? 1 : 0\n      },\n      className: styles['project-detail-video-control-bar']\n    }, __jsx(\"div\", {\n      className: styles['bar']\n    }, __jsx(\"div\", {\n      className: styles['progress'],\n      style: {\n        width: progress + '%'\n      }\n    }))), __jsx(\"video\", {\n      src: v.src,\n      ref: videoRef,\n      autoPlay: false,\n      style: {\n        width: '1600rem',\n        \"float\": 'left'\n      }\n    }));\n  }) : null, affix_image_meta ? _Array$from({\n    length: affix_image_meta.num\n  }).map(function (_, i) {\n    if (i === 0) {\n      return;\n    }\n\n    var common_file = affix_image_meta.dir + '/' + (detail_images_meta.num + i + 1).toString();\n    return __jsx(LazyLoadImg, {\n      src: common_file + '.jpg',\n      sources: [{\n        type: 'image/webp',\n        src: common_file + '.webp'\n      }],\n      preview_src: common_file + '-preview.jpg',\n      preview_sources: [{\n        type: 'image/webp',\n        src: common_file + '-preview.webp'\n      }],\n      className: styles['project-detail-details-images']\n    });\n  }) : null));\n};\nexport default ProjectDetailItem;","map":null,"metadata":{},"sourceType":"module"}